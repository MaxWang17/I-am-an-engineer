{"code":"// 实现关键的Handelr，里面有get、有set\r\nimport { extend, isObject } from \"@vue/shared/src\";\r\nimport { track } from \"./effect\";\r\nimport { reactive, readonly } from \"./reactive\";\r\n// 考虑1：是不是仅读，仅读的属性set时会报异常\r\n// 考虑2：是不是深度\r\nlet readonlyObj = {\r\n    set: (target, key) => {\r\n        console.warn(`set on key  ${key} failed`);\r\n    },\r\n};\r\nconst get = createGetter();\r\nconst shallowGet = createGetter(false, true);\r\nconst readonlyGet = createGetter(true);\r\nconst shallowReadonlyGet = createGetter(true, true);\r\nconst set = createSetter();\r\nconst shallowSet = createSetter(true);\r\nconst mutableHandlers = {\r\n    get,\r\n};\r\nconst shallowReactiveHandlers = {\r\n    get: shallowGet,\r\n};\r\nconst readonlyHandlers = extend({\r\n    get: readonlyGet,\r\n}, readonlyObj);\r\nconst shallowReadonlyHandlers = extend({\r\n    get: shallowReadonlyGet,\r\n}, readonlyObj);\r\nexport { mutableHandlers, shallowReactiveHandlers, readonlyHandlers, shallowReadonlyHandlers, };\r\nfunction createGetter(isReadonly = false, isShallow = false) {\r\n    // 核心拦截方法\r\n    return function get(target, key, receiver) {\r\n        // let proxy = reactivee()\r\n        // proxy + reflect(后续obiect上的方法会被迁移到reflect)\r\n        // 在以前，target[key] = vlaue 可能会失败（如果target只读），并不会报异常，也没有返回值标识\r\n        // reflect方法具备返回值\r\n        const res = Reflect.get(target, key, receiver);\r\n        if (!isReadonly) {\r\n            // 收集依赖，会等数据变化后更新对应的视图\r\n            console.log(\"收集effect\", new Date);\r\n            track(target, 0 /* GET */, key); // TrackOpTypes.GET目前只是一个标识\r\n        }\r\n        if (isShallow) {\r\n            return res;\r\n        }\r\n        if (isObject(res)) { // vue2 是一上来就递归，vue3 是当取值时会进行代理。vue3的代理模式是懒代理。\r\n            return isReadonly ? readonly(res) : reactive(res);\r\n        }\r\n        return res;\r\n    };\r\n}\r\nfunction createSetter(isShallow = false) {\r\n    // 核心设置方法\r\n    return function set(target, key, value, receiver) {\r\n        const res = Reflect.set(target, key, value, receiver);\r\n        // 当数据更新时，通知对应属性的effect重新执行\r\n        // 我们要区分是新增还是修改的。vue2里无法监控更改索引，无法监控数组长度变化；vue3都解决了。但其中还是有hack的方法，需要特殊处理。\r\n        const oldValue = target[key]; // 获取老的值\r\n        return res;\r\n    };\r\n}\r\n//# sourceMappingURL=baseHandlers.js.map","references":["E:/私人/I-am-an-engineer/Vue/Vue3SC/packages/shared/src/index.ts","E:/私人/I-am-an-engineer/Vue/Vue3SC/packages/reactivity/src/effect.ts","E:/私人/I-am-an-engineer/Vue/Vue3SC/packages/reactivity/src/operators.ts","E:/私人/I-am-an-engineer/Vue/Vue3SC/packages/reactivity/src/reactive.ts"],"map":"{\"version\":3,\"file\":\"baseHandlers.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../packages/reactivity/src/baseHandlers.ts\"],\"names\":[],\"mappings\":\"AAAA,2BAA2B;AAE3B,OAAO,EAAE,MAAM,EAAW,QAAQ,EAAE,MAAM,iBAAiB,CAAC;AAC5D,OAAO,EAAE,KAAK,EAAE,MAAM,UAAU,CAAC;AAEjC,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,MAAM,YAAY,CAAC;AAEhD,0BAA0B;AAC1B,YAAY;AAEZ,IAAI,WAAW,GAAG;IAChB,GAAG,EAAE,CAAC,MAAM,EAAE,GAAG,EAAE,EAAE;QACnB,OAAO,CAAC,IAAI,CAAC,eAAe,GAAG,SAAS,CAAC,CAAC;IAC5C,CAAC;CACF,CAAC;AAEF,MAAM,GAAG,GAAG,YAAY,EAAE,CAAC;AAC3B,MAAM,UAAU,GAAG,YAAY,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;AAC7C,MAAM,WAAW,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;AACvC,MAAM,kBAAkB,GAAG,YAAY,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AACpD,MAAM,GAAG,GAAG,YAAY,EAAE,CAAC;AAC3B,MAAM,UAAU,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;AAEtC,MAAM,eAAe,GAAG;IACtB,GAAG;CACJ,CAAC;AAEF,MAAM,uBAAuB,GAAG;IAC9B,GAAG,EAAE,UAAU;CAChB,CAAC;AAEF,MAAM,gBAAgB,GAAG,MAAM,CAC7B;IACE,GAAG,EAAE,WAAW;CACjB,EACD,WAAW,CACZ,CAAC;AAEF,MAAM,uBAAuB,GAAG,MAAM,CACpC;IACE,GAAG,EAAE,kBAAkB;CACxB,EACD,WAAW,CACZ,CAAC;AAEF,OAAO,EACL,eAAe,EACf,uBAAuB,EACvB,gBAAgB,EAChB,uBAAuB,GACxB,CAAC;AAEF,SAAS,YAAY,CAAC,UAAU,GAAG,KAAK,EAAE,SAAS,GAAG,KAAK;IACzD,SAAS;IACT,OAAO,SAAS,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ;QACvC,0BAA0B;QAC1B,4CAA4C;QAC5C,4DAA4D;QAC5D,iBAAiB;QAEjB,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAC;QAE/C,IAAG,CAAC,UAAU,EAAC;YACX,sBAAsB;YACtB,OAAO,CAAC,GAAG,CAAC,UAAU,EAAC,IAAI,IAAI,CAAC,CAAA;YAChC,KAAK,CAAC,MAAM,eAAkB,GAAG,CAAC,CAAA,CAAC,2BAA2B;SACjE;QAED,IAAG,SAAS,EAAC;YACT,OAAO,GAAG,CAAA;SACb;QAED,IAAG,QAAQ,CAAC,GAAG,CAAC,EAAC,EAAE,8CAA8C;YAC7D,OAAO,UAAU,CAAC,CAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAA,CAAC,CAAA,QAAQ,CAAC,GAAG,CAAC,CAAA;SAClD;QAED,OAAO,GAAG,CAAC;IACb,CAAC,CAAC;AACJ,CAAC;AACD,SAAS,YAAY,CAAC,SAAS,GAAG,KAAK;IACrC,SAAS;IACT,OAAO,SAAS,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ;QAC9C,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;QAEtD,2BAA2B;QAE3B,wEAAwE;QACxE,MAAM,QAAQ,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,QAAQ;QAItC,OAAO,GAAG,CAAC;IACb,CAAC,CAAC;AACJ,CAAC\"}"}
